<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.pet.ft.mapper">
  
  	<resultMap type="MemberDto" id="memberListMap">
  		<result property="member_no" column="MEMBER_NO"/>
  		<result property="member_name" column="MEMBER_NAME"/>
  		<result property="member_id" column="MEMBER_ID"/>
  		<result property="member_pw" column="MEMBER_PW"/>
  		<result property="member_email" column="MEMBER_EMAIL"/>
  		<result property="member_phone" column="MEMBER_PHONE"/>
  		<result property="member_role" column="MEMBER_ROLE"/>
  		<result property="member_address" column="MEMBER_ADDRESS"/>
  	</resultMap>
  	
  	<resultMap type="CommunityDto" id="reportListMap">
  		<result property="community_seq" column="COMMUNITY_SEQ"/>
  		<result property="community_title" column="COMMUNITY_TITLE"/>
  		<result property="community_content" column="COMMUNITY_CONTENT"/>
  		<result property="community_regdate" column="COMMUNITY_REGDATE"/>
  		<result property="community_report" column="COMMUNITY_REPORT"/>
  		<result property="community_reportcount" column="COMMUNITY_REPORTCOUNT"/>
  		<result property="community_no" column="COMMUNITY_NO"/>
  		<result property="community_comment" column="COMMUNITY_COMMENT"/>
  		<result property="member_no" column="MEMBER_NO"/>
  		<result property="community_reportcontent" column="COMMUNITY_REPORTCONTENT"/>
  		<collection property="memberVO" resultMap="memberListMap"></collection>
  	</resultMap>
  
  	<select id="totalMember" resultType="int">
  		SELECT COUNT(*) FROM MEMBER
  	</select>
  	
  	<select id="memberList" parameterType="String" resultMap="memberListMap" >
  		<![CDATA[
  		SELECT MEMBER_NO, MEMBER_NAME, MEMBER_ID, MEMBER_EMAIL, MEMBER_ROLE, MEMBER_PHONE, MEMBER_ADDRESS
  		FROM MEMBER
  		WHERE MEMBER_NO >(SELECT MAX(MEMBER_NO) FROM MEMBER) - #{pageNumber * 10} AND MEMBER_NO <= (SELECT MAX(MEMBER_NO) FROM MEMBER) - #{(pageNumber - 1) * 10} ORDER BY MEMBER_NO DESC
  		]]>
  	</select> 
  	
  	<update id="changeRole" parameterType="MemberDto">
  		UPDATE MEMBER
  		SET MEMBER_ROLE = #{member_role}
  		WHERE MEMBER_NO = #{member_no}
  	</update>
  	
  	<select id="totalReport" resultType="int">
  		SELECT COUNT(*) FROM COMMUNITY WHERE COMMUNITY_REPORT = 'Y'
  	</select>
  	
  	<select	id="reportList" resultMap="reportListMap">
  		SELECT a.COMMUNITY_SEQ, a.COMMUNITY_TITLE, a .COMMUNITY_REPORTCOUNT, a.COMMUNITY_REPORTCONTENT, a.COMMUNITY_REGDATE, b.MEMBER_ID
  		FROM COMMUNITY a JOIN MEMBER b on a.member_no = b.member_no WHERE COMMUNITY_REPORT = 'Y'
  		ORDER BY COMMUNITY_SEQ DESC
  	</select>
  	
  	<delete id="deleteCommunity" parameterType="int">
  		DELETE FROM COMMUNITY
  		WHERE COMMUNITY_SEQ = #{seq}
  	</delete>
  	
  	<select id="nextPage" parameterType="int" resultType="String">
  		<![CDATA[
  		SELECT * FROM MEMBER WHERE MEMBER_NO >= #{pageNumber }
  		]]>
  	</select>
  	
  	
  	
  </mapper>