<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.pet.ft.mapper">
  
  	<resultMap type="MemberDto" id="memberListMap">
  		<result property="member_no" column="MEMBER_NO"/>
  		<result property="member_name" column="MEMBER_NAME"/>
  		<result property="member_id" column="MEMBER_ID"/>
  		<result property="member_pw" column="MEMBER_PW"/>
  		<result property="member_email" column="MEMBER_EMAIL"/>
  		<result property="member_phone" column="MEMBER_PHONE"/>
  		<result property="member_role" column="MEMBER_ROLE"/>
  		<result property="member_address" column="MEMBER_ADDRESS"/>
  	</resultMap>
  	
  	<resultMap type="CommunityDto" id="reportListMap">
  		<result property="community_seq" column="COMMUNITY_SEQ"/>
  		<result property="community_title" column="COMMUNITY_TITLE"/>
  		<result property="community_content" column="COMMUNITY_CONTENT"/>
  		<result property="community_regdate" column="COMMUNITY_REGDATE"/>
  		<result property="community_report" column="COMMUNITY_REPORT"/>
  		<result property="community_reportcount" column="COMMUNITY_REPORTCOUNT"/>
  		<result property="community_no" column="COMMUNITY_NO"/>
  		<result property="community_comment" column="COMMUNITY_COMMENT"/>
  		<result property="member_no" column="MEMBER_NO"/>
  		<result property="community_reportcontent" column="COMMUNITY_REPORTCONTENT"/>
  		<collection property="memberVO" resultMap="memberListMap"></collection>
  	</resultMap>
  	
  	<resultMap type="BookDto" id="bookListMap">
  		
  	</resultMap>
  
  	<select id="totalMember" resultType="int">
  		SELECT COUNT(*) FROM MEMBER
  	</select>
  	
	<select id="totalReport" resultType="int">
  		SELECT COUNT(*) FROM COMMUNITY WHERE COMMUNITY_REPORT = 'Y'
  	</select>
  	
<!--   	
	<select id="memberList" resultMap="memberListMap" >
  		<![CDATA[
  		SELECT MEMBER_NO, MEMBER_NAME, MEMBER_ID, MEMBER_EMAIL, MEMBER_ROLE, MEMBER_PHONE, MEMBER_ADDRESS
  		FROM MEMBER
  		ORDER BY MEMBER_NO DESC
  		]]>
  	</select>
  		
  	<select	id="reportList" resultMap="reportListMap">
  		SELECT a.COMMUNITY_SEQ, a.COMMUNITY_TITLE, a .COMMUNITY_REPORTCOUNT, a.COMMUNITY_REPORTCONTENT, a.COMMUNITY_REGDATE, b.MEMBER_ID
  		FROM COMMUNITY a JOIN MEMBER b on a.member_no = b.member_no WHERE COMMUNITY_REPORT = 'Y'
  		ORDER BY COMMUNITY_SEQ DESC
  	</select>	 -->
  		
  	<select id="memberListPaging" parameterType="hashmap" resultMap="memberListMap" >
		<![CDATA[
		SELECT B.RNUM, B.MEMBER_NO, B.MEMBER_NAME, B.MEMBER_ID, B.MEMBER_EMAIL, B.MEMBER_ROLE, B.MEMBER_PHONE, B.MEMBER_ADDRESS
		FROM(
			SELECT ROWNUM AS RNUM, A.MEMBER_NO, A.MEMBER_NAME, A.MEMBER_ID, A.MEMBER_EMAIL, A.MEMBER_ROLE, A.MEMBER_PHONE, A.MEMBER_ADDRESS
			FROM(
					SELECT  MEMBER_NO, MEMBER_NAME, MEMBER_ID, MEMBER_EMAIL, MEMBER_ROLE, MEMBER_PHONE, MEMBER_ADDRESS
					FROM MEMBER
					ORDER BY MEMBER_NO) A
			WHERE ROWNUM <= #{noOfRecords}) B
		WHERE B.RNUM > #{offset}
		]]>
  	</select>
  	
  	<select	id="reportListPaging" parameterType="hashmap" resultMap="reportListMap">
  		<![CDATA[
  		SELECT D.RNUM, D.COMMUNITY_SEQ, D.COMMUNITY_TITLE, D.COMMUNITY_REPORTCOUNT, D.COMMUNITY_REPORTCONTENT, D.COMMUNITY_REGDATE, D.MEMBER_ID
		FROM(
			SELECT ROWNUM AS RNUM, C.COMMUNITY_SEQ, C.COMMUNITY_TITLE, C.COMMUNITY_REPORTCOUNT, C.COMMUNITY_REPORTCONTENT, C.COMMUNITY_REGDATE, C.MEMBER_ID
			FROM(
				SELECT A.COMMUNITY_SEQ, A.COMMUNITY_TITLE, A.COMMUNITY_REPORTCOUNT, A.COMMUNITY_REPORTCONTENT, A.COMMUNITY_REGDATE, B.MEMBER_ID
				FROM COMMUNITY A JOIN MEMBER B on A.member_no = B.member_no WHERE COMMUNITY_REPORT = 'Y'
				ORDER BY COMMUNITY_SEQ) C
			WHERE ROWNUM <= #{noOfRecords}) D
		WHERE D.RNUM > #{offset}
		]]>
  	</select>
  	
  	<select	id="bookListPaging" parameterType="hashmap" resultMap="reportListMap">
  		<![CDATA[
  		SELECT E.RNUM, E.BOOK_NUM, E.MEMBER_NAME, E.BUSINESS_NAME, E.BOOK_DATE
		FROM(
			SELECT ROWNUM AS RNUM, D.BOOK_NUM, D.MEMBER_NAME, D.BUSINESS_NAME, D.BOOK_DATE
			FROM(
				SELECT A.BOOK_NUM, B.MEMBER_NAME, C.BUSINESS_NAME, A.BOOK_DATE
				FROM BOOK A JOIN MEMBER B 
				ON A.MEMBER_NO = B.MEMBER_NO 
				JOIN BUSINESS C
				ON A.BUSINESS_NUM = C.BUSINESS_NUM
				ORDER BY A.BOOK_NUM
			) D
			WHERE ROWNUM <= {noOfRecords}) E
		WHERE E.RNUM > #{offset}
		]]>
  	</select>
  	
  	
  	
  	<update id="changeRole" parameterType="MemberDto">
  		UPDATE MEMBER
  		SET MEMBER_ROLE = #{member_role}
  		WHERE MEMBER_NO = #{member_no}
  	</update>
  	
  	<delete id="deleteCommunity" parameterType="int">
  		DELETE FROM COMMUNITY
  		WHERE COMMUNITY_SEQ = #{seq}
  	</delete>
  	
  	
  </mapper>